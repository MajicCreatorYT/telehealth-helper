<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeleHealth Helper for Seniors</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        button, .btn-large { min-height: 60px; min-width: 60px; font-size: 1.5rem; }
        .message-text { font-size: 1.3rem; line-height: 1.6; }
        *:focus { outline: 4px solid #fbbf24; outline-offset: 2px; }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
        <div class="bg-blue-700 text-white p-6">
            <h1 class="text-4xl font-bold">ðŸ©º TeleHealth Helper</h1>
            <p class="text-2xl mt-2">Ask me anything â€“ I'm here to help!</p>
        </div>

        <div id="chat" class="h-96 overflow-y-auto p-6 space-y-4 bg-gray-50"></div>

        <div class="p-6 border-t bg-white">
            <div class="flex gap-4 flex-wrap">
                <button id="voiceBtn" class="bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-xl text-2xl font-bold">ðŸŽ¤ Speak</button>
                <input type="text" id="textInput" placeholder="Type your question..." class="flex-1 p-4 text-2xl border-2 border-gray-300 rounded-xl">
                <button id="sendBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-xl text-2xl font-bold">Send ðŸ“¤</button>
            </div>

            <div class="mt-6 flex flex-wrap gap-3">
                <button class="suggest-btn bg-gray-200 hover:bg-gray-300 px-6 py-3 rounded-full text-xl">What is telehealth?</button>
                <button class="suggest-btn bg-gray-200 hover:bg-gray-300 px-6 py-3 rounded-full text-xl">How do I prepare?</button>
                <button class="suggest-btn bg-gray-200 hover:bg-gray-300 px-6 py-3 rounded-full text-xl">Is it safe?</button>
                <button class="suggest-btn bg-gray-200 hover:bg-gray-300 px-6 py-3 rounded-full text-xl">I'm not good with computers</button>
            </div>
        </div>
    </div>

    <script>
        const chatDiv = document.getElementById('chat');
        const textInput = document.getElementById('textInput');
        const sendBtn = document.getElementById('sendBtn');
        const voiceBtn = document.getElementById('voiceBtn');

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';
        }

        function speak(text) {
            if (!window.speechSynthesis) return;
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.9;
            utterance.pitch = 1;
            window.speechSynthesis.speak(utterance);
        }

        function addMessage(role, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            const bubble = document.createElement('div');
            bubble.className = `max-w-3xl p-4 rounded-2xl text-xl ${role === 'user' ? 'bg-blue-600 text-white' : 'bg-white border-2 border-gray-200 text-gray-800'}`;
            const textSpan = document.createElement('span');
            textSpan.className = 'message-text';
            textSpan.innerText = content;
            bubble.appendChild(textSpan);
            messageDiv.appendChild(bubble);
            chatDiv.appendChild(messageDiv);
            chatDiv.scrollTop = chatDiv.scrollHeight;
            if (role === 'assistant') speak(content);
        }

        async function sendMessage(message) {
            addMessage('user', message);
            textInput.value = '';
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                const data = await response.json();
                addMessage('assistant', data.reply);
            } catch {
                addMessage('assistant', 'Sorry, Iâ€™m having trouble connecting. Please try again.');
            }
        }

        sendBtn.addEventListener('click', () => {
            if (textInput.value.trim()) sendMessage(textInput.value);
        });

        textInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && textInput.value.trim()) sendMessage(textInput.value);
        });

        if (recognition) {
            voiceBtn.addEventListener('click', () => {
                voiceBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                voiceBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                voiceBtn.textContent = 'â¹ï¸ Listening...';
                recognition.start();
            });

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                textInput.value = transcript;
                sendMessage(transcript);
            };

            recognition.onend = () => {
                voiceBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                voiceBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                voiceBtn.textContent = 'ðŸŽ¤ Speak';
            };

            recognition.onerror = () => {
                alert('Voice recognition failed. Please type your question.');
                voiceBtn.click();
            };
        } else {
            voiceBtn.disabled = true;
            voiceBtn.textContent = 'ðŸŽ¤ Not supported';
        }

        document.querySelectorAll('.suggest-btn').forEach(btn => {
            btn.addEventListener('click', () => sendMessage(btn.innerText));
        });
    </script>
</body>
</html>